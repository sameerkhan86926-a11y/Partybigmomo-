<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floating YouTube Player - Glass UI</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0; padding: 0;
    background: linear-gradient(135deg,#0f0f0f,#1c1c1c);
    color: #fff; text-align: center;
  }
  h1 { margin: 20px 0; }
  #search-container { display: flex; gap:10px; justify-content:center; align-items:center; margin:20px auto; max-width:600px; }
  input { flex:1; padding:10px; border-radius:10px; border:none; outline:none; font-size:16px; background: rgba(255,255,255,0.1); color:#fff; }
  button { padding:10px 15px; border-radius:10px; border:none; cursor:pointer; font-weight:bold; }
  #search-btn { background:#ff0000; color:#fff; }
  #voice-btn { background:#00ccff; color:#000; }
  #results { display:flex; flex-direction:column; align-items:center; margin-top:20px; }
  .video-item { width:90%; max-width:500px; background: rgba(255,255,255,0.05); margin:10px; padding:10px; border-radius:12px; cursor:pointer; display:flex; align-items:center; gap:10px; transition:0.3s; backdrop-filter: blur(6px); }
  .video-item:hover { background: rgba(255,255,255,0.1); }
  .video-item img { width:120px; border-radius:6px; }

  #player-container { position: fixed; bottom:20px; right:20px; z-index:9999; background: rgba(0,0,0,0.5); backdrop-filter: blur(12px); border-radius:16px; overflow:hidden; display:none; cursor: grab; box-shadow:0 0 20px rgba(0,0,0,0.7); }
  #player { width:320px; height:180px; border-radius:12px; }
  #close-btn { position:absolute; top:5px; right:5px; background:red; color:white; border:none; border-radius:50%; width:28px; height:28px; cursor:pointer; font-weight:bold; }
</style>
</head>
<body>

<h1>üé§ Floating YouTube Player - Glass UI</h1>

<div id="search-container">
  <input type="text" id="search-input" placeholder="Search YouTube...">
  <button id="search-btn">Search</button>
  <button id="voice-btn">üéôÔ∏è Voice</button>
</div>

<div id="results"></div>

<div id="player-container">
  <button id="close-btn">‚úï</button>
  <div id="player"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const apiKey = "AIzaSyBeFQ9lfxdr5nAY1F4yLlt-GaPIAruDPKY"; // üî¥ Replace with your key
const searchInput = document.getElementById("search-input");
const searchBtn = document.getElementById("search-btn");
const voiceBtn = document.getElementById("voice-btn");
const results = document.getElementById("results");
const playerContainer = document.getElementById("player-container");
let player;

// --- YouTube Player ---
function onYouTubeIframeAPIReady(){
  player = new YT.Player("player", {
    height:"180", width:"320", videoId:"",
    playerVars:{autoplay:1, controls:1, rel:0, mute:1},
    events:{onReady:()=>console.log("‚úÖ Player Ready")}
  });
}

// --- Play Video with delay to fix black issue ---
function playVideo(videoId){
  if(!player) return;
  playerContainer.style.display="block";
  // Load video after slight delay to ensure player ready
  setTimeout(()=>{
    player.loadVideoById({videoId:videoId, suggestedQuality:"default"});
    player.playVideo();
    // Wait for user interaction to unmute
    player.mute();
  }, 300);
}

// --- Search YouTube ---
async function searchYouTube(query){
  if(!query) return;
  results.innerHTML="<p>Searching...</p>";
  try{
    const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoEmbeddable=true&maxResults=10&q=${encodeURIComponent(query)}&key=${apiKey}`);
    const data = await res.json();
    results.innerHTML="";
    data.items.forEach(item=>{
      const vid = document.createElement("div");
      vid.className="video-item";
      vid.innerHTML=`
        <img src="${item.snippet.thumbnails.default.url}">
        <div>
          <h4>${item.snippet.title}</h4>
          <p>${item.snippet.channelTitle}</p>
        </div>`;
      vid.onclick=()=>playVideo(item.id.videoId);
      results.appendChild(vid);
    });
  }catch(err){ results.innerHTML="<p>Error fetching results</p>"; console.error(err); }
}

// --- Event Listeners ---
searchBtn.addEventListener("click", ()=>searchYouTube(searchInput.value.trim()));
document.getElementById("close-btn").addEventListener("click", ()=>{
  playerContainer.style.display="none"; player.stopVideo();
});

// --- Voice Recognition ---
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang='en-US'; recognition.interimResults=false; recognition.maxAlternatives=1;

  voiceBtn.addEventListener("click", ()=>{
    recognition.start(); voiceBtn.innerText="üé§ Listening...";
  });

  recognition.onresult=(event)=>{
    const transcript = event.results[0][0].transcript;
    searchInput.value = transcript;
    searchYouTube(transcript);
    voiceBtn.innerText="üéôÔ∏è Voice";
  }

  recognition.onerror=(event)=>{
    console.error("Voice error:", event.error);
    voiceBtn.innerText="üéôÔ∏è Voice";
  }
}else{ voiceBtn.style.display="none"; }

// --- Draggable Player ---
playerContainer.onmousedown=function(e){
  let shiftX = e.clientX - playerContainer.getBoundingClientRect().left;
  let shiftY = e.clientY - playerContainer.getBoundingClientRect().top;

  function moveAt(pageX,pageY){ playerContainer.style.left = pageX - shiftX + 'px'; playerContainer.style.top = pageY - shiftY + 'px'; }
  function onMouseMove(e){ moveAt(e.pageX,e.pageY); }

  document.addEventListener('mousemove',onMouseMove);
  document.onmouseup=function(){ document.removeEventListener('mousemove',onMouseMove); document.onmouseup=null; };
};
playerContainer.ondragstart = ()=>false;

</script>
</body>
</html>